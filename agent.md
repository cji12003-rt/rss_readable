# RSS読み上げニュースアプリ 要件定義（個人用）

## 概要
個人用 Android アプリ。Pixel 7a などで動作。  
RSS フィードを登録・保存し、ニュース記事（少なくともタイトル）を連続で読み上げるアプリ。画面オフでも読み上げを継続させる。

## 用語定義
| 用語 | 意味 |
|---|---|
| RSSURL | ニュースフィードの URL（XMLフィード） |
| 記事 | RSS から取得したアイテム。少なくとも `タイトル` を含む。将来的には本文取得も可。 |
| 読み上げ | Text-to-Speech (TTS) による音声出力。順次・連続で行う。 |

## 対応プラットフォーム・技術
- Android（最低 API レベルはおおむね 26 以上想定）  
- 開発言語：Kotlin  
- TTS：Android 標準 `TextToSpeech` API  
- RSS XML パース：`XmlPullParser` または `Jsoup` 等  
- 永続保存：`SharedPreferences`（将来的に Room 等へ拡張可能）  
- 常駐動作：ForegroundService + Notification  
- 通知操作：再生／停止／スキップ等将来的に含む

## 機能要件（MVP＋拡張フェーズ付き、優先順位あり）

| 番号 | 機能 | 優先度 | 説明 |
|---|---|---|---|
| 1 | RSS フィードURLを **パラメータで設定可能** | 高 | アプリ起動時または設定画面で指定でき、ハードコーディングに依存しないが、初期値も持たせてよい。 |
| 2 | RSS フィードの取得 & 記事タイトルのパース | 高 | 登録された RSSURL から取得し、記事（少なくともタイトル）一覧を構築。 |
| 3 | 連続読み上げ | 高 | 記事リストの順番に TTS で読み上げ；読み上げが終わったら次の記事へ。 |
| 4 | ForegroundService を使って画面オフでも読み上げ継続 | 高 | Android のフォアグラウンドサービス + 通知を用いて本体がスリープ／画面オフになっても読み上げを止めない。 |
| 5 | 通知から停止操作 | 中 | 通知バーから読み上げを止めるボタンを持たせる。 |
| 6 | 通知からスキップ操作（次の記事へ） | 中 | 再生中の記事を飛ばして次の記事を読み始める操作を通知界隈または UI 上に。 |
| 7 | RSSURL を保存し、変更可能にする機能 | 中 | `SharedPreferences` 等で永続保存。設定画面での編集。都度入力ではない。 |
| 8 | 複数 RSSURL を登録できるようにする | 低／拡張 | 複数のフィードを登録し、順繰りに取得 → 読み上げ。 |
| 9 | 正規表現フィルタリングによる記事スキップ機能 | 低／拡張 | タイトルが特定パターンにマッチしたら読み飛ばす。パターン編集可能。 |
| 10 | 記事本文の取得 & 本文読み上げ | 低／拡張 | フィードの本文も取得して、タイトルだけでなく本文も読み上げる。サイトによってはパース処理が複雑。 |
| 11 | 読み上げ設定の調整 UI（速度・声質） | 低／拡張 | TTS の速度・ピッチ・言語などを設定可能にする。 |

## 非機能要件

- 動作は個人用。Google Play 公開を前提としないので、最低限の権限で動作すればよい。  
- バッテリー消費に注意。ForegroundService を使うのは不可欠だが、できるだけ無駄な処理をしない。  
- Android の API レベルによる仕様の変動を吸収すること（サービス型式、通知ポリシーなど）。  
- UI はシンプルで最小限。設定・状態表示・操作ボタンのみ。  

## 制約条件

- 初期バージョン（MVP）では RSSURL はパラメータで指定できるが、登録 UI は将来的フェーズで。  
- MVP では複数 URL 登録・正規表現フィルタ・本文読み上げなどは実装しない。  
- 常に画面オフで読み上げ続けること。もし Android の電源最適化等で停止するなら、ユーザーに設定を促すこと。

## 技術上の注意点・外部参照

- Android 14 (API 34) では Foreground Service に `android:foregroundServiceType` の指定が必須。:contentReference[oaicite:0]{index=0}  
- Manifest に適切な permission を宣言する必要あり。:contentReference[oaicite:1]{index=1}  
- Notification チャネルを設定し、通知の表示を確実にする。ForegroundService 通知はユーザーに明示される必要あり。:contentReference[oaicite:2]{index=2}  

## インターフェース（API/パラメータ）

- アプリ起動時または Intent パラメータで RSSURL を受け取る（例：起動 Intent に `--rssUrl=<url>`）  
- デフォルト RSSURL をコード内またはリソースで定義しておく  
- 将来の設定画面で URL の編集が可能  
- 読み上げ制御の操作: 再生・停止・スキップ（将来的）  

## 画面・UI仕様（MVP フェーズのみ）

- 起動画面（MainActivity）  
  - デフォルトまたはパラメータで得た RSSURL を表示（または `TextView` か `EditText` に表示）  
  - 「再生」「停止」ボタン  
  - 記事タイトル一覧（ListView / RecyclerView）を表示（読み上げ対象）  
- 通知  
  - ForegroundService 用通知に「停止」ボタンを含む  
  - 将来的に通知に「スキップ」も追加  

## テストケース

| テスト内容 | 期待結果 |
|---|---|
| パラメータで起動時に指定した RSSURL が読み込まれる | 指定 URL の記事タイトルが取得できること |
| デフォルト URL（パラメータなし）で起動した場合 | デフォルトの RSSURL を使って記事取得すること |
| 連続読み上げボタンを押す | 記事タイトルを順番に TTS で読み上げること |
| 読み上げ途中で画面をオフにする | 読み上げが停止せず継続すること |
| 通知の「停止」ボタン | 読み上げを停止し ForegroundService が終了、通知が消えること |

## スケジュール案（MVPフェーズ）

1. 基本構造のセットアップ  
   - プロジェクト作成、必要パーミッション設定（TTS・ForegroundService）  
   - デフォルト RSSURL を持たせる仕組み  
2. RSS取得・パース機能の実装  
3. TTS 読み上げ単一記事 → 連続読み上げロジック  
4. ForegroundService + 通知＋停止操作実装  
5. UIで記事リスト表示、再生／停止ボタン設置  
6. テスト：画面オフ、停止操作の動作確認  

## 将来のフェーズ（拡張案）

- 複数 RSSURL 登録  
- 正規表現フィルタ機能  
- 本文取得 & 本文読み上げ  
- 読み上げ速度・声をユーザー設定可能に  
- 通知からスキップ操作  

